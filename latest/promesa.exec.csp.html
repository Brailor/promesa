<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>promesa.exec.csp documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="highlight/solarized-light.css" /><script type="text/javascript" src="highlight/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a> with <a href="https://github.com/xsc/codox-theme-rdash">RDash UI</a> theme</h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Promesa</span> <span class="project-version"></span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Topics</span></h3><ul><li class="depth-1 "><a href="intro.html"><div class="inner"><span>Getting Started</span></div></a></li><li class="depth-1 "><a href="promises.html"><div class="inner"><span>Working with Promises</span></div></a></li><li class="depth-1 "><a href="executors.html"><div class="inner"><span>Scheduling &amp; Executors</span></div></a></li><li class="depth-1 "><a href="channels.html"><div class="inner"><span>Channels (CSP pattern)</span></div></a></li><li class="depth-1 "><a href="bulkhead.html"><div class="inner"><span>Bulkhead (concurrency limiter)</span></div></a></li><li class="depth-1 "><a href="contributing.html"><div class="inner"><span>Contributing</span></div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>promesa</span></div></div></li><li class="depth-2 branch"><a href="promesa.core.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-2"><a href="promesa.exec.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>exec</span></div></a></li><li class="depth-3 branch"><a href="promesa.exec.bulkhead.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>bulkhead</span></div></a></li><li class="depth-3 current"><a href="promesa.exec.csp.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>csp</span></div></a></li><li class="depth-2"><a href="promesa.protocols.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>protocols</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="promesa.exec.csp.html#var-.3C.21"><div class="inner"><span>&lt;!</span></div></a></li><li class="depth-1"><a href="promesa.exec.csp.html#var-.3E.21"><div class="inner"><span>&gt;!</span></div></a></li><li class="depth-1"><a href="promesa.exec.csp.html#var-alts"><div class="inner"><span>alts</span></div></a></li><li class="depth-1"><a href="promesa.exec.csp.html#var-alts.21"><div class="inner"><span>alts!</span></div></a></li><li class="depth-1"><a href="promesa.exec.csp.html#var-chan"><div class="inner"><span>chan</span></div></a></li><li class="depth-1"><a href="promesa.exec.csp.html#var-chan.3F"><div class="inner"><span>chan?</span></div></a></li><li class="depth-1"><a href="promesa.exec.csp.html#var-close.21"><div class="inner"><span>close!</span></div></a></li><li class="depth-1"><a href="promesa.exec.csp.html#var-closed.3F"><div class="inner"><span>closed?</span></div></a></li><li class="depth-1"><a href="promesa.exec.csp.html#var-dropping-buffer"><div class="inner"><span>dropping-buffer</span></div></a></li><li class="depth-1"><a href="promesa.exec.csp.html#var-fixed-buffer"><div class="inner"><span>fixed-buffer</span></div></a></li><li class="depth-1"><a href="promesa.exec.csp.html#var-go"><div class="inner"><span>go</span></div></a></li><li class="depth-1"><a href="promesa.exec.csp.html#var-go-loop"><div class="inner"><span>go-loop</span></div></a></li><li class="depth-1"><a href="promesa.exec.csp.html#var-offer.21"><div class="inner"><span>offer!</span></div></a></li><li class="depth-1"><a href="promesa.exec.csp.html#var-onto-chan.21"><div class="inner"><span>onto-chan!</span></div></a></li><li class="depth-1"><a href="promesa.exec.csp.html#var-pipe"><div class="inner"><span>pipe</span></div></a></li><li class="depth-1"><a href="promesa.exec.csp.html#var-poll.21"><div class="inner"><span>poll!</span></div></a></li><li class="depth-1"><a href="promesa.exec.csp.html#var-put.21"><div class="inner"><span>put!</span></div></a></li><li class="depth-1"><a href="promesa.exec.csp.html#var-sleep"><div class="inner"><span>sleep</span></div></a></li><li class="depth-1"><a href="promesa.exec.csp.html#var-sliding-buffer"><div class="inner"><span>sliding-buffer</span></div></a></li><li class="depth-1"><a href="promesa.exec.csp.html#var-take.21"><div class="inner"><span>take!</span></div></a></li><li class="depth-1"><a href="promesa.exec.csp.html#var-timeout"><div class="inner"><span>timeout</span></div></a></li><li class="depth-1"><a href="promesa.exec.csp.html#var-timeout-chan"><div class="inner"><span>timeout-chan</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">promesa.exec.csp</h1><div class="doc"><div class="markdown"><p>A core.async analogous implementation of channels that uses promises instead of callbacks for all operations and are intended to be used as-is (using blocking operations) in go-blocks backed by virtual threads.</p>
<p>There are no macro transformations, go blocks are just alias for the <code>promesa.core/vthread</code> macro that launches an virtual thread.</p>
<p>This code is based on the same ideas as core.async but the implementation is written from scratch, for make it more simplier (and smaller, because it does not intend to solve all the corner cases that core.async does right now).</p>
<p>This code is implemented in CLJS for make available the channel abstraction to the CLJS, but the main use case for this ns is targeted to the JVM, where you will be able to take advantage of virtual threads and seamless blocking operations on channels.</p>
<p><strong>EXPERIMENTAL API</strong></p>
</div></div><div class="public anchor" id="var-.3C.21"><h3>&lt;!</h3><div class="usage"><code>(&lt;! port val)</code><code>(&lt;! port val timeout-ms)</code><code>(&lt;! port val timeout-ms timeout-val)</code></div><div class="doc"><div class="markdown"><p>A blocking version of <code>take!</code></p>
</div></div><div class="src-link"><a href="https://github.com/funcool/promesa/blob/master/src/promesa/exec/csp.clj#L109">view source</a></div></div><div class="public anchor" id="var-.3E.21"><h3>&gt;!</h3><div class="usage"><code>(&gt;! port val)</code><code>(&gt;! port val timeout-ms)</code><code>(&gt;! port val timeout-ms timeout-val)</code></div><div class="doc"><div class="markdown"><p>A blocking version of <code>put!</code></p>
</div></div><div class="src-link"><a href="https://github.com/funcool/promesa/blob/master/src/promesa/exec/csp.clj#L100">view source</a></div></div><div class="public anchor" id="var-alts"><h3>alts</h3><div class="usage"><code>(alts ports &amp; {:as opts})</code></div><div class="doc"><div class="markdown"><p>Completes at most one of several operations on channel. Receives a vector of operations and optional keyword options.</p>
<p>A channel operation is defined as a vector of 2 elements for take, and 3 elements for put. Unless the :priority option is true and if more than one channel operation is ready, a non-deterministic choice will be made.</p>
<p>Returns a promise instance that will be resolved when a single operation is ready to a vector <a href="val channel">val channel</a> where val is return value of the operation and channel identifies the channel where the the operation is succeeded.</p>
</div></div><div class="src-link"><a href="https://github.com/funcool/promesa/blob/master/src/promesa/exec/csp.clj#L145">view source</a></div></div><div class="public anchor" id="var-alts.21"><h3>alts!</h3><div class="usage"><code>(alts! ports &amp; {:as opts})</code></div><div class="doc"><div class="markdown"><p>A blocking variant of <code>alts</code>.</p>
</div></div><div class="src-link"><a href="https://github.com/funcool/promesa/blob/master/src/promesa/exec/csp.clj#L161">view source</a></div></div><div class="public anchor" id="var-chan"><h3>chan</h3><div class="usage"><code>(chan)</code><code>(chan buf)</code><code>(chan buf xf)</code><code>(chan buf xf exh)</code></div><div class="doc"><div class="markdown"><p>Creates a new channel instance, it optionally accepts buffer, transducer and error handler.</p>
</div></div><div class="src-link"><a href="https://github.com/funcool/promesa/blob/master/src/promesa/exec/csp.clj#L48">view source</a></div></div><div class="public anchor" id="var-chan.3F"><h3>chan?</h3><div class="usage"><code>(chan? o)</code></div><div class="doc"><div class="markdown"><p>Returns true if <code>o</code> is instance of Channel or satisfies IChannel protocol.</p>
</div></div><div class="src-link"><a href="https://github.com/funcool/promesa/blob/master/src/promesa/exec/csp.clj#L177">view source</a></div></div><div class="public anchor" id="var-close.21"><h3>close!</h3><div class="usage"><code>(close! port)</code></div><div class="doc"><div class="markdown"><p>Close the channel.</p>
</div></div><div class="src-link"><a href="https://github.com/funcool/promesa/blob/master/src/promesa/exec/csp.clj#L166">view source</a></div></div><div class="public anchor" id="var-closed.3F"><h3>closed?</h3><div class="usage"><code>(closed? port)</code></div><div class="doc"><div class="markdown"><p>Returns true if channel is closed.</p>
</div></div><div class="src-link"><a href="https://github.com/funcool/promesa/blob/master/src/promesa/exec/csp.clj#L172">view source</a></div></div><div class="public anchor" id="var-dropping-buffer"><h3>dropping-buffer</h3><div class="usage"><code>(dropping-buffer n)</code></div><div class="doc"><div class="markdown"><p>Create a dropping buffer instance.</p>
</div></div><div class="src-link"><a href="https://github.com/funcool/promesa/blob/master/src/promesa/exec/csp.clj#L211">view source</a></div></div><div class="public anchor" id="var-fixed-buffer"><h3>fixed-buffer</h3><div class="usage"><code>(fixed-buffer n)</code></div><div class="doc"><div class="markdown"><p>Create a fixed size buffer instance.</p>
</div></div><div class="src-link"><a href="https://github.com/funcool/promesa/blob/master/src/promesa/exec/csp.clj#L216">view source</a></div></div><div class="public anchor" id="var-go"><h3>go</h3><h4 class="type">macro</h4><div class="usage"><code>(go &amp; body)</code></div><div class="doc"><div class="markdown"><p>Schedules the body to be executed asychronously, potentially using virtual thread if available (a normal thread will be used in other case). Returns a promise instance that resolves with the return value when the asynchronous block finishes.</p>
</div></div><div class="src-link"><a href="https://github.com/funcool/promesa/blob/master/src/promesa/exec/csp.clj#L34">view source</a></div></div><div class="public anchor" id="var-go-loop"><h3>go-loop</h3><h4 class="type">macro</h4><div class="usage"><code>(go-loop bindings &amp; body)</code></div><div class="doc"><div class="markdown"><p>A convencience helper macro that combines go + loop.</p>
</div></div><div class="src-link"><a href="https://github.com/funcool/promesa/blob/master/src/promesa/exec/csp.clj#L43">view source</a></div></div><div class="public anchor" id="var-offer.21"><h3>offer!</h3><div class="usage"><code>(offer! port val)</code></div><div class="doc"><div class="markdown"><p>Puts a val into channel if it’s possible to do so immediately. Returns a resolved promise with <code>true</code> if the operation succeeded. Never blocks.</p>
</div></div><div class="src-link"><a href="https://github.com/funcool/promesa/blob/master/src/promesa/exec/csp.clj#L221">view source</a></div></div><div class="public anchor" id="var-onto-chan.21"><h3>onto-chan!</h3><div class="usage"><code>(onto-chan! ch coll)</code><code>(onto-chan! ch coll close?)</code></div><div class="doc"><div class="markdown"><p>Puts the contents of coll into the supplied channel.</p>
<p>By default the channel will be closed after the items are copied, but can be determined by the close? parameter. Returns a channel which will close after the items are copied.</p>
</div></div><div class="src-link"><a href="https://github.com/funcool/promesa/blob/master/src/promesa/exec/csp.clj#L254">view source</a></div></div><div class="public anchor" id="var-pipe"><h3>pipe</h3><div class="usage"><code>(pipe from to)</code><code>(pipe from to close?)</code></div><div class="doc"><div class="markdown"><p>Takes elements from the from channel and supplies them to the to channel. By default, the to channel will be closed when the from channel closes, but can be determined by the close?  parameter. Will stop consuming the from channel if the to channel closes.</p>
</div></div><div class="src-link"><a href="https://github.com/funcool/promesa/blob/master/src/promesa/exec/csp.clj#L239">view source</a></div></div><div class="public anchor" id="var-poll.21"><h3>poll!</h3><div class="usage"><code>(poll! port)</code></div><div class="doc"><div class="markdown"><p>Takes a val from port if it’s possible to do so immediatelly. Returns a resolved promise with the value if succeeded, <code>nil</code> otherwise.</p>
</div></div><div class="src-link"><a href="https://github.com/funcool/promesa/blob/master/src/promesa/exec/csp.clj#L230">view source</a></div></div><div class="public anchor" id="var-put.21"><h3>put!</h3><div class="usage"><code>(put! port val)</code><code>(put! port val timeout-ms)</code><code>(put! port val timeout-ms timeout-val)</code></div><div class="doc"><div class="markdown"><p>Schedules a put operation on the channel. Returns a promise instance that will resolve to: false if channel is closed, true if put is succeed. If channel has buffer, it will return immediatelly with resolved promise.</p>
</div></div><div class="src-link"><a href="https://github.com/funcool/promesa/blob/master/src/promesa/exec/csp.clj#L60">view source</a></div></div><div class="public anchor" id="var-sleep"><h3>sleep</h3><div class="usage"><code>(sleep ms)</code></div><div class="doc"><div class="markdown"><p>Turn the current thread to sleep.</p>
</div></div><div class="src-link"><a href="https://github.com/funcool/promesa/blob/master/src/promesa/exec/csp.clj#L182">view source</a></div></div><div class="public anchor" id="var-sliding-buffer"><h3>sliding-buffer</h3><div class="usage"><code>(sliding-buffer n)</code></div><div class="doc"><div class="markdown"><p>Create a sliding buffer instance.</p>
</div></div><div class="src-link"><a href="https://github.com/funcool/promesa/blob/master/src/promesa/exec/csp.clj#L206">view source</a></div></div><div class="public anchor" id="var-take.21"><h3>take!</h3><div class="usage"><code>(take! port)</code><code>(take! port timeout-ms)</code><code>(take! port timeout-ms timeout-val)</code></div><div class="doc"><div class="markdown"><p>Schedules a take operation on the channel. Returns a promise instance that will resolve to: nil if channel is closed, obj if value is found. If channel has non-empty buffer the take operation will succeed immediatelly with resolved promise.</p>
</div></div><div class="src-link"><a href="https://github.com/funcool/promesa/blob/master/src/promesa/exec/csp.clj#L80">view source</a></div></div><div class="public anchor" id="var-timeout"><h3>timeout</h3><div class="usage"><code>(timeout ms)</code></div><div class="doc"><div class="markdown"><p>Returns a promise that will be resolved in the specified timeout. The default scheduler will be used.</p>
</div></div><div class="src-link"><a href="https://github.com/funcool/promesa/blob/master/src/promesa/exec/csp.clj#L200">view source</a></div></div><div class="public anchor" id="var-timeout-chan"><h3>timeout-chan</h3><div class="usage"><code>(timeout-chan ms)</code><code>(timeout-chan scheduler ms)</code></div><div class="doc"><div class="markdown"><p>Returns a channel that will be closed in the specified timeout. The default scheduler will be used. You can provide your own as optional first argument.</p>
</div></div><div class="src-link"><a href="https://github.com/funcool/promesa/blob/master/src/promesa/exec/csp.clj#L187">view source</a></div></div></div></body></html>